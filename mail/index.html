<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Smart Screw Driver System</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <div class="dashboard">
        <!-- Top Header -->
        <div class="main-header">
            <img src="logo-white.svg" alt="Nokia Logo" class="nokia-logo">
            <span class="title">SMART SCREW DRIVER SYSTEM</span>
        </div>

        <!-- Resource/Type/Model Row -->
        <div class="resource-model-row">
            <span>RESOURCE: MAC-LINE02</span>
            <span>TYPE: DEPRAG-AS712</span>
            <span>MODEL: ARCA</span>
        </div>

        <!-- ID Input & Controls Row -->
        <div class="id-controls-row">
            <div class="id-input-group">
                <div class="input-group">
                    <label for="stationId">STATION ID</label>
                    <input type="text" id="stationId" readonly>
                </div>
                <div class="input-group">
                    <label for="paletteId">PALETTE ID</label>
                    <input type="text" id="paletteId" readonly>
                </div>
                <div class="input-group">
                    <label for="chassisId">CHASSIS ID</label>
                    <input type="text" id="chassisId" readonly>
                </div>
                <button id="refreshStationData" class="btn-refresh">â†»</button>
            </div>
            <div class="controls-group">
                 <button class="btn-control start" id="startBtn">START</button>
                 <div class="status-display screw-driver" id="screwDriverStatus">SCREW DRIVER</div>
                 <div class="status-display plcm-status" id="plcmStatus">PLCM STATUS</div>
            </div>
        </div>

        <!-- Present Values Row -->
        <div class="present-values-row">
            <div class="present-values-group">
                <div class="input-group present">
                    <label for="presentScrewId">PRESENT SCREW ID:</label>
                    <input type="text" id="presentScrewId" value="" readonly>
                </div>
                <div class="input-group present">
                    <label for="presentAngle">PRESENT ANGLE:</label>
                    <input type="text" id="presentAngle" value="" readonly>
                </div>
                <div class="input-group present">
                    <label for="presentTorque">PRESENT TORQUE:</label>
                    <input type="text" id="presentTorque" value="" readonly>
                </div>
            </div>
            <!-- Cycle navigation will be inserted here by cycleNav.js -->
        </div>

        <!-- Table and Image Row -->
        <div class="table-image-row">
            <!-- Table -->
            <div class="table-container">
                <table>
                    <thead>
                        <tr>
                            <th rowspan="2">Screw ID</th>
                            <th colspan="3">Angle</th>
                            <th colspan="3">Torque</th>
                        </tr>
                        <tr>
                            <th>Min</th><th>Max</th><th>Actual</th>
                            <th>Min</th><th>Max</th><th>Actual</th>
                        </tr>
                    </thead>
                    <tbody id="screwDataTableBody">
                        <!-- Rows will be generated by JS -->
                    </tbody>
                </table>
            </div>

            <!-- Image -->
            <div class="image-container">
                <div class="sub-div">
                    <img src="img.jpg" alt="Hardware Base" class="hardware-image">
                    <div class="sub-div-dub-div">

                        <div id="screw-markers-overlay"></div>
                    </div>
                </div>
                <!-- <div id="screw-markers-overlay"> -->
                <!-- </div> -->
            </div>
        </div>

        <!-- Action Buttons Row -->
        <div class="action-buttons-row">
            <button class="btn-action">ANGLE PATTERN</button>
            <button class="btn-action">TORQUE PATTERN</button>
            <button class="btn-action" id="generateReportBtn">GENERATE REPORT</button>
        </div>

    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.23/jspdf.plugin.autotable.min.js"></script>
    <!-- Add html2canvas library -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <!-- Load the main application script as a module -->
    <script type="module" src="src/app.js"></script>
    <script>
        // Script to fetch station data from temp.js API
        document.addEventListener('DOMContentLoaded', function() {
            // Get DOM elements
            const stationIdInput = document.getElementById('stationId');
            const paletteIdInput = document.getElementById('paletteId');
            const chassisIdInput = document.getElementById('chassisId');
            const refreshBtn = document.getElementById('refreshStationData');
            
            // Function to fetch station data
            async function fetchStationData() {
                try {
                    // Visual feedback during loading
                    stationIdInput.value = "Loading...";
                    paletteIdInput.value = "Loading...";
                    chassisIdInput.value = "Loading...";
                    
                    // Fetch from temp.js API (running on port 3332)
                    const response = await fetch('http://localhost:3332/api/station');
                    
                    if (!response.ok) {
                        throw new Error(`HTTP error! Status: ${response.status}`);
                    }
                    
                    const stationData = await response.json();
                    
                    // Get the most recent record if available
                    if (stationData && stationData.length > 0) {
                        const latestData = stationData[stationData.length - 1];
                        
                        stationIdInput.value = latestData.station_id || '';
                        paletteIdInput.value = latestData.palette_id || '';
                        chassisIdInput.value = latestData.chassis_id || '';
                        
                        console.log('Station data loaded successfully');
                    } else {
                        // No data available
                        stationIdInput.value = "No data";
                        paletteIdInput.value = "No data";
                        chassisIdInput.value = "No data";
                    }
                } catch (error) {
                    console.error('Error fetching station data:', error);
                    stationIdInput.value = "Error";
                    paletteIdInput.value = "Error";
                    chassisIdInput.value = "Error";
                }
            }
            
            // Fetch data on page load
            fetchStationData();
            
            // Refresh button click handler
            if (refreshBtn) {
                refreshBtn.addEventListener('click', fetchStationData);
            }
            
            // Periodically refresh data (every 30 seconds)
            setInterval(fetchStationData, 30000);
        });
    </script>
</body>
</html>
